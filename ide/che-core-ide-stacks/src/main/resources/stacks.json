[
  {
    "id": "zend",
    "creator": "ide",
    "name": "Zend",
    "description": "Zend stack with PHP 7, Zend Server 9 and Z-Ray.",
    "scope": "general",
    "tags": [
      "PHP",
      "Zend",
      "Z-Ray",
      "Composer",
      "Ubuntu",
      "Git"
    ],
    "components": [
      {
        "name": "PHP",
        "version": "7.0.11"
      },
      {
        "name": "Zend Server",
        "version": "9.0.1"
      },
      {
        "name": "Composer",
        "version": "---"
      }
    ],
    "source": {
      "type": "image",
      "origin": "kaloyanraev/che-zendserver"
    },
    "workspaceConfig": {
      "environments": {
        "default": {
          "machines": {
            "dev-machine": {
              "agents": [
                "org.eclipse.che.terminal", "org.eclipse.che.ws-agent", "org.eclipse.che.ssh", "org.eclipse.che.ls.php", "org.eclipse.che.ls.json"
              ],
              "servers": {},
              "attributes" : {
                "memoryLimitBytes": "2147483648"
              }
            }
          },
          "recipe": {
            "location": "kaloyanraev/che-zendserver",
            "type": "dockerimage"
          }
        }
      },
      "name": "default",
      "defaultEnv": "default",
      "description": null,
      "commands": [
        {
          "name": "restart zend server",
          "type": "custom",
          "commandLine": "sudo sqlite3 /usr/local/zend/var/db/zsd.db \"UPDATE ZSD_DIRECTIVES SET DISK_VALUE='http://${server.port.10081}/ZendServer' WHERE NAME='zray.zendserver_ui_url'\" && sudo sed -i 's#zray.zendserver_ui_url=.*#zray.zendserver_ui_url=http://${server.port.10081}/ZendServer#g' /usr/local/zend/etc/conf.d/zray.ini && sudo /usr/local/zend/bin/zendctl.sh restart",
          "attributes": {
            "previewUrl": "http://${server.port.80}"
          }
        },
        {
          "name": "stop zend server",
          "type": "custom",
          "commandLine": "sudo /usr/local/zend/bin/zendctl.sh stop",
          "attributes": {
            "previewUrl": ""
          }
        },
        {
          "name": "show admin password",
          "type": "custom",
          "commandLine": "echo \"Zend Server admin password is `sudo cat /root/zend-password`\"",
          "attributes": {
            "previewUrl": "http://${server.port.10081}"
          }
        }
      ]
    },
    "stackIcon": {
      "name": "type-zend.svg",
      "mediaType": "image/svg+xml"
    }
  },
  {
    "id": "zend-mysql",
    "creator": "ide",
    "name": "Zend-MySQL",
    "description": "Multi-machine environment with Zend stack and MySQL database.",
    "scope": "general",
    "tags": [
      "PHP",
      "Zend",
      "Z-Ray",
      "Composer",
      "Ubuntu",
      "Git",
      "MySQL"
    ],
    "components": [
      {
        "name": "PHP",
        "version": "7.0.11"
      },
      {
        "name": "Zend Server",
        "version": "9.0.1"
      },
      {
        "name": "MySQL",
        "version": "5.7"
      },
      {
        "name": "Composer",
        "version": "---"
      }
    ],
    "source": {
      "type": "image",
      "origin": "kaloyanraev/che-zendserver"
    },
    "workspaceConfig": {
      "environments": {
        "default": {
          "machines": {
            "dev-machine": {
              "agents": [
                "org.eclipse.che.terminal", "org.eclipse.che.ws-agent", "org.eclipse.che.ssh", "org.eclipse.che.ls.php", "org.eclipse.che.ls.json"
              ],
              "servers": {},
              "attributes" : {}
            },
            "db": {
              "agents": [
                "org.eclipse.che.terminal"
              ],
              "servers": {},
              "attributes" : {}
            }
          },
          "recipe": {
            "content": "services:\n db:\n  image: mysql\n  environment:\n   MYSQL_ROOT_PASSWORD: password\n  mem_limit: 1073741824\n dev-machine:\n  image: kaloyanraev/che-zendserver\n  mem_limit: 2147483648\n  depends_on:\n    - db",
            "contentType": "application/x-yaml",
            "type": "compose"
          }
        }
      },
      "name": "default",
      "defaultEnv": "default",
      "description": null,
      "commands": [  
        {
          "name": "restart zend server",
          "type": "custom",
          "commandLine": "sudo sqlite3 /usr/local/zend/var/db/zsd.db \"UPDATE ZSD_DIRECTIVES SET DISK_VALUE='http://${server.port.10081}/ZendServer' WHERE NAME='zray.zendserver_ui_url'\" && sudo sed -i 's#zray.zendserver_ui_url=.*#zray.zendserver_ui_url=http://${server.port.10081}/ZendServer#g' /usr/local/zend/etc/conf.d/zray.ini && sudo /usr/local/zend/bin/zendctl.sh restart",
          "attributes": {
            "previewUrl": "http://${server.port.80}"
          }
        },
        {
          "name": "stop zend server",
          "type": "custom",
          "commandLine": "sudo /usr/local/zend/bin/zendctl.sh stop",
          "attributes": {
            "previewUrl": ""
          }
        },
        {
          "name": "show admin password",
          "type": "custom",
          "commandLine": "echo \"Zend Server admin password is `sudo cat /root/zend-password`\"",
          "attributes": {
            "previewUrl": "http://${server.port.10081}"
          }
        }
      ]
    },
    "stackIcon": {
      "name": "type-zend.svg",
      "mediaType": "image/svg+xml"
    }
  }
]
